TÃ“M Táº®T useEffect TRONG REACT

1. useEffect lÃ  gÃ¬?
useEffect dÃ¹ng Ä‘á»ƒ xá»­ lÃ½ side effects trong React function component.
Side effects lÃ  cÃ¡c tÃ¡c vá»¥ khÃ´ng trá»±c tiáº¿p liÃªn quan Ä‘áº¿n viá»‡c render UI nhÆ°:
- Gá»i API
- Set interval / timeout
- Láº¯ng nghe sá»± kiá»‡n (scroll, resize)
- Thao tÃ¡c DOM thá»§ cÃ´ng
- Äá»“ng bá»™ localStorage
- Káº¿t ná»‘i / ngáº¯t káº¿t ná»‘i (WebSocket, subscription)

NguyÃªn táº¯c:
- Render chá»‰ Ä‘á»ƒ váº½ UI
- useEffect dÃ¹ng Ä‘á»ƒ xá»­ lÃ½ logic bÃªn ngoÃ i render

2. CÃº phÃ¡p cÆ¡ báº£n

useEffect(() => {
  // side effect logic

  return () => {
    // cleanup
  };
}, [dependencies]);

Gá»“m:
- Effect function
- Cleanup function (tÃ¹y chá»n)
- Dependency array

3. Khi nÃ o useEffect cháº¡y?

a. KhÃ´ng cÃ³ dependency
useEffect(() => { ... });
â†’ Cháº¡y sau má»—i láº§n render (Ã­t dÃ¹ng)

b. Dependency rá»—ng []
useEffect(() => { ... }, []);
â†’ Chá»‰ cháº¡y 1 láº§n khi component mount
DÃ¹ng cho:
- Gá»i API ban Ä‘áº§u
- Khá»Ÿi táº¡o dá»¯ liá»‡u
- Add event listener

c. CÃ³ dependency
useEffect(() => { ... }, [count]);
â†’ Cháº¡y khi dependency thay Ä‘á»•i
DÃ¹ng cho:
- Gá»i API theo Ä‘iá»u kiá»‡n
- Äá»“ng bá»™ dá»¯ liá»‡u
- Cáº­p nháº­t side effect theo state

4. Cleanup function

Cleanup cháº¡y khi:
- Component unmount
- TrÆ°á»›c khi effect cháº¡y láº¡i

DÃ¹ng Ä‘á»ƒ:
- Clear interval / timeout
- Remove event listener
- Há»§y subscription
- Ngáº¯t káº¿t ná»‘i

Náº¿u khÃ´ng cleanup cÃ³ thá»ƒ gÃ¢y memory leak.

5. VÃ²ng Ä‘á»i cá»§a useEffect

useEffect gáº¯n vá»›i dá»¯ liá»‡u (dependency), khÃ´ng pháº£i lifecycle component.

Chu trÃ¬nh:
- Mount: Render â†’ Effect cháº¡y
- Update dependency:
  Render â†’ Cleanup â†’ Effect cháº¡y láº¡i
- Unmount:
  Cleanup cháº¡y láº§n cuá»‘i

Thá»© tá»±:
Render â†’ Effect
Render â†’ Cleanup â†’ Effect
Unmount â†’ Cleanup

6. Khi nÃ o nÃªn dÃ¹ng useEffect?

NÃŠN dÃ¹ng:
- Gá»i API
- LÃ m viá»‡c vá»›i browser API
- Timer, event, storage

KHÃ”NG nÃªn dÃ¹ng:
- TÃ­nh toÃ¡n dá»¯ liá»‡u Ä‘á»ƒ render
- Gá»™p state tá»« state khÃ¡c

1. Táº¡i sao NÃŠN dÃ¹ng useEffect cho cÃ¡c tÃ¡c vá»¥ sau?
Äiá»ƒm chung cá»§a cÃ¡c tÃ¡c vá»¥ nÃ y lÃ  chÃºng cáº§n tÆ°Æ¡ng tÃ¡c vá»›i tháº¿ giá»›i bÃªn ngoÃ i React.

ğŸŒ Gá»i API (Data Fetching)
LÃ½ do: Khi báº¡n muá»‘n láº¥y dá»¯ liá»‡u tá»« Server, viá»‡c nÃ y máº¥t thá»i gian (báº¥t Ä‘á»“ng bá»™). Báº¡n khÃ´ng thá»ƒ gá»i gá»i API trá»±c tiáº¿p trong thÃ¢n Component vÃ¬ React yÃªu cáº§u hÃ m render pháº£i lÃ  má»™t hÃ m thuáº§n khiáº¿t (pure function) â€“ tá»©c lÃ  nÃ³ chá»‰ nháº­n vÃ o Props/State vÃ  tráº£ ra UI ngay láº­p tá»©c.
HÃ nh Ä‘á»™ng: useEffect cho phÃ©p báº¡n render giao diá»‡n "Ä‘ang táº£i" (loading) trÆ°á»›c, sau Ä‘Ã³ má»›i Ä‘i láº¥y dá»¯ liá»‡u vÃ  cáº­p nháº­t láº¡i giao diá»‡n sau khi cÃ³ dá»¯ liá»‡u.
ğŸ–¥ï¸ LÃ m viá»‡c vá»›i Browser API (DOM thá»§ cÃ´ng)
LÃ½ do: ÄÃ´i khi báº¡n cáº§n thay Ä‘á»•i document.title, cuá»™n trang (window.scrollTo), hoáº·c táº­p trung vÃ o má»™t Ã´ nháº­p liá»‡u (input.focus()). Nhá»¯ng thá»© nÃ y React khÃ´ng quáº£n lÃ½ trá»±c tiáº¿p.
HÃ nh Ä‘á»™ng: Báº¡n cáº§n Ä‘á»£i React váº½ xong UI ra mÃ n hÃ¬nh (commit), lÃºc Ä‘Ã³ DOM tháº­t má»›i tá»“n táº¡i Ä‘á»ƒ báº¡n tÆ°Æ¡ng tÃ¡c.
â±ï¸ Timer, Event, Storage
LÃ½ do: Nhá»¯ng thá»© nÃ y cáº§n Ä‘Æ°á»£c Khá»Ÿi táº¡o vÃ  quan trá»ng nháº¥t lÃ  Dá»n dáº¹p (Cleanup).
Timer: setInterval, setTimeout.
Event: Láº¯ng nghe sá»± kiá»‡n cuá»™n chuá»™t (scroll), thay Ä‘á»•i kÃ­ch thÆ°á»›c mÃ n hÃ¬nh (resize).
Storage: Äá»c/ghi localStorage khi cÃ³ má»™t giÃ¡ trá»‹ nÃ o Ä‘Ã³ thay Ä‘á»•i.
HÃ nh Ä‘á»™ng: useEffect cung cáº¥p hÃ m return () => { ... } (cleanup function) Ä‘á»ƒ gá»¡ bá» event listener hoáº·c xÃ³a timer khi Component bá»‹ há»§y, trÃ¡nh bá»‹ Memory Leak (trÃ n bá»™ nhá»›).
2. Táº¡i sao KHÃ”NG NÃŠN dÃ¹ng useEffect cho cÃ¡c tÃ¡c vá»¥ sau?
ÄÃ¢y lÃ  lá»—i phá»• biáº¿n nháº¥t khiáº¿n App React cháº¡y cháº­m vÃ  code bá»‹ khÃ³ hiá»ƒu (spaghetti).

ğŸ§® TÃ­nh toÃ¡n dá»¯ liá»‡u Ä‘á»ƒ render
VÃ­ dá»¥: Báº¡n cÃ³ firstName vÃ  lastName, báº¡n muá»‘n táº¡o fullName.
CÃ¡ch SAI (DÃ¹ng Effect):
javascript
useEffect(() => {
    setFullName(`${firstName} ${lastName}`);
}, [firstName, lastName]);
Táº¡i sao SAI: Khi firstName thay Ä‘á»•i, React sáº½:
Render vá»›i tÃªn cÅ©.
Cháº¡y useEffect.
Gá»i setFullName -> KÃ­ch hoáº¡t Render láº§n 2. => LÃ£ng phÃ­ hiá»‡u nÄƒng.
CÃ¡ch ÄÃšNG: TÃ­nh toÃ¡n trá»±c tiáº¿p trong lÃºc render.
javascript
const fullName = `${firstName} ${lastName}`; // Tá»± cáº­p nháº­t má»—i khi render
ğŸ”— Gá»™p state tá»« state khÃ¡c (Derived State)
VÃ­ dá»¥: Báº¡n cÃ³ danh sÃ¡ch cartItems vÃ  muá»‘n tÃ­nh totalPrice.
CÃ¡ch SAI: DÃ¹ng useEffect Ä‘á»ƒ theo dÃµi cartItems rá»“i setTotalPrice.
Táº¡i sao SAI: Báº¡n Ä‘ang táº¡o ra má»™t "chuá»—i pháº£n á»©ng" (Chain of effects). Thay Ä‘á»•i State A -> Cháº¡y Effect -> Cáº­p nháº­t State B -> Láº¡i Render... Äiá»u nÃ y lÃ m code cá»±c ká»³ khÃ³ debug.
CÃ¡ch ÄÃšNG: Náº¿u má»™t giÃ¡ trá»‹ cÃ³ thá»ƒ tÃ­nh toÃ¡n Ä‘Æ°á»£c tá»« cÃ¡c State/Props hiá»‡n cÃ³, Ä‘á»«ng bao giá» cho nÃ³ vÃ o State riÃªng. HÃ£y dÃ¹ng useMemo náº¿u phÃ©p tÃ­nh Ä‘Ã³ cá»±c ká»³ náº·ng, cÃ²n khÃ´ng cá»© tÃ­nh tháº³ng trong hÃ m.
javascript
const totalPrice = cartItems.reduce((acc, item) => acc + item.price, 0);

7. TÆ° duy Ä‘Ãºng khi dÃ¹ng useEffect

HÃ£y há»i:
"Logic nÃ y cÃ³ cáº§n tÆ°Æ¡ng tÃ¡c vá»›i tháº¿ giá»›i bÃªn ngoÃ i React khÃ´ng?"

- CÃ³ â†’ useEffect
- KhÃ´ng â†’ xá»­ lÃ½ trá»±c tiáº¿p trong render

TÃ³m láº¡i:
useEffect dÃ¹ng Ä‘á»ƒ Ä‘á»“ng bá»™ component vá»›i tháº¿ giá»›i bÃªn ngoÃ i vÃ  cháº¡y theo sá»± thay Ä‘á»•i cá»§a dependency.